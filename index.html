<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>韓国語4択クイズ</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #e0f7fa;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

/* ===== 50まとめ ===== */
#groupSelect {
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
  overflow-y: auto;
}

.group-btn {
  width: 100%;
  padding: 16px;
  font-size: 22px;
  margin-bottom: 12px;
  border-radius: 14px;
  border: none;
  background: #4dd0e1;
}

.group-btn.gold {
  background: gold;
}

/* ===== 詳細チャプター ===== */
#chapterSelect {
  display: none;
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
  overflow-y: auto;
}

#chapters {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.chapter-btn {
  aspect-ratio: 1 / 1;
  font-size: 20px;
  border-radius: 12px;
  border: none;
  background: #81d4fa;
}

.chapter-btn.gold {
  background: gold;
}

/* ===== クイズ画面 ===== */
#quiz {
  display: none;
  position: fixed;
  inset: 0;
}

#question {
  margin-top: env(safe-area-inset-top);
  padding: 30px;
  text-align: center;
  font-size: 36px;
}

#choices {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  padding: 0 20px;
}

.choice {
  padding: 14px;
  font-size: 20px;
  border-radius: 10px;
  border: none;
  background: #b2ebf2;
}

#backBtn {
  margin: 20px auto;
  display: block;
  padding: 12px 26px;
  font-size: 18px;
}
</style>
</head>

<body>

<!-- 50まとめ -->
<div id="groupSelect"></div>

<!-- 詳細チャプター -->
<div id="chapterSelect">
  <div id="chapters"></div>
</div>

<!-- クイズ -->
<div id="quiz">
  <div id="question"></div>
  <div id="choices"></div>
  <button id="backBtn">もどる</button>
</div>

<script>
let words = [];
let chapters = [];
let currentGroup = 0;
let currentChapter = 0;
let qIndex = 0;
let streak = 0;

const chapterPerfect = new Set();

fetch("words.csv")
  .then(r => r.text())
  .then(t => {
    words = t.split("\n").map(l => l.split(",")).filter(w => w[0]);
    for (let i = 0; i < words.length; i += 10) {
      chapters.push(words.slice(i, i + 10));
    }
    renderGroups();
  });

function renderGroups() {
  groupSelect.innerHTML = "";
  const gCount = Math.ceil(chapters.length / 5);
  for (let g = 0; g < gCount; g++) {
    const b = document.createElement("button");
    b.className = "group-btn";
    b.textContent = `${g*50+1}-${Math.min((g+1)*50, words.length)}`;
    if ([...Array(5)].every((_,i)=>chapterPerfect.has(g*5+i))) {
      b.classList.add("gold");
    }
    b.onclick = () => openGroup(g);
    groupSelect.appendChild(b);
  }
}

function openGroup(g) {
  currentGroup = g;
  groupSelect.style.display = "none";
  chapterSelect.style.display = "block";
  renderChapters();
}

function renderChapters() {
  chaptersDiv.innerHTML = "";
  const start = currentGroup * 5;
  const end = Math.min(start + 5, chapters.length);
  for (let i = start; i < end; i++) {
    const b = document.createElement("button");
    b.textContent = i + 1;
    b.className = "chapter-btn";
    if (chapterPerfect.has(i)) b.classList.add("gold");
    b.onclick = () => startQuiz(i);
    chaptersDiv.appendChild(b);
  }
}

function startQuiz(c) {
  currentChapter = c;
  qIndex = 0;
  streak = 0;
  chapterSelect.style.display = "none";
  quiz.style.display = "block";
  showQuestion();
}

function showQuestion() {
  const q = chapters[currentChapter][qIndex];
  question.textContent = q[0];

  const correct = q[1];
  const choices = [correct];

  while (choices.length < 4) {
    const r = words[Math.floor(Math.random() * words.length)][1];
    if (!choices.includes(r)) choices.push(r);
  }

  choices.sort(() => Math.random() - 0.5);
  choicesDiv.innerHTML = "";

  choices.forEach(c => {
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = c;
    b.onclick = () => answer(c === correct);
    choicesDiv.appendChild(b);
  });
}

function answer(ok) {
  if (ok) {
    streak++;
    if (streak === 10) chapterPerfect.add(currentChapter);
  } else {
    streak = 0;
  }

  qIndex++;
  if (qIndex >= chapters[currentChapter].length) {
    quiz.style.display = "none";
    renderGroups();
    openGroup(Math.floor(currentChapter / 5));
  } else {
    showQuestion();
  }
}

backBtn.onclick = () => {
  quiz.style.display = "none";
  openGroup(Math.floor(currentChapter / 5));
};
</script>

</body>
</html>