<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>韓国語4択クイズ</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #e0f7fa;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}
.screen {
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom);
  box-sizing: border-box;
  display: none;
}

/* ===== チャプター選択 ===== */
#chapterSelect {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  overflow-y: auto;
  padding: 10px;
}
.chapter-btn {
  aspect-ratio: 1 / 1;
  font-size: 22px;
  border-radius: 12px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,0.2);
}
.chapter-btn:active {
  transform: scale(0.94);
}

/* ===== クイズ画面 ===== */
#quiz {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
#quizInfo {
  align-self: flex-start;
  font-size: 16px;
  margin-bottom: 6px;
}
#quizWord {
  font-size: 36px;
  text-align: center;
  background: #b2ebf2;
  padding: 16px 20px;
  border-radius: 14px;
  border: 2px solid #4dd0e1;
  margin-bottom: 20px;
}
#choices {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 240px;
}
.choice {
  font-size: 18px;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: #ffffff;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
  word-break: break-word;
}
.choice.correct { background: #b9f6ca; }
.choice.wrong { background: #ffcdd2; }
#backToChapter {
  margin-top: 20px;
  font-size: 18px;
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
}

/* ===== 結果画面 ===== */
#result {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
}
#resultList {
  width: 90%;
  max-height: 70%;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}
.result-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  border-radius: 10px;
  border: 2px solid #b2ebf2;
  background: #fff;
}
.result-item.correct { background: #b9f6ca; }
.result-item.wrong { background: #ffcdd2; }

#resultButtons {
  display: flex;
  gap: 14px;
}
.result-btn {
  font-size: 18px;
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
}
.result-btn:active { transform: scale(0.94); }
</style>
</head>
<body>

<!-- チャプター選択 -->
<div id="chapterSelect" class="screen"></div>

<!-- クイズ画面 -->
<div id="quiz" class="screen">
  <div id="quizInfo"></div>
  <div id="quizWord"></div>
  <div id="choices"></div>
  <button id="backToChapter">チャプター選択に戻る</button>
</div>

<!-- 結果画面 -->
<div id="result" class="screen">
  <div id="resultList"></div>
  <div id="resultButtons">
    <button id="resBack" class="result-btn">チャプター選択に戻る</button>
    <button id="resRetry" class="result-btn">もう一度解く</button>
    <button id="resNext" class="result-btn">次のチャプターに行く</button>
  </div>
</div>

<script>
let words = [];
let chapters = [];
let currentChapter = [];
let quizIndex = 0;
let correctCount = 0;
let quizResults = [];

/* CSV読み込み */
fetch("words.csv")
  .then(r => r.text())
  .then(text => {
    words = text.split("\n").map(l=>l.split(",")).filter(w=>w[0]);
    for(let i=0;i<words.length;i+=10){
      chapters.push(words.slice(i,i+10));
    }
    renderChapters();
  });

/* チャプター選択 */
const chapterDiv = document.getElementById("chapterSelect");
function renderChapters(){
  chapterDiv.innerHTML = "";
  chapters.forEach((_,i)=>{
    const b = document.createElement("button");
    b.className = "chapter-btn";
    b.textContent = i+1;
    b.onclick = ()=>startChapter(i);
    chapterDiv.appendChild(b);
  });
  chapterDiv.style.display = "grid";
}

/* クイズ開始 */
const quizScreen = document.getElementById("quiz");
const quizWord = document.getElementById("quizWord");
const choicesDiv = document.getElementById("choices");
const quizInfo = document.getElementById("quizInfo");
const backBtn = document.getElementById("backToChapter");
backBtn.onclick = ()=>{ quizScreen.style.display="none"; chapterDiv.style.display="grid"; };

function startChapter(i){
  currentChapter = chapters[i];
  quizIndex = 0;
  correctCount = 0;
  quizResults = [];
  chapterDiv.style.display = "none";
  quizScreen.style.display = "flex";
  showQuiz();
}

function showQuiz(){
  const q = currentChapter[quizIndex];
  quizWord.textContent = q[0];
  quizInfo.innerHTML = `チャプター${chapters.indexOf(currentChapter)+1}<br>${quizIndex+1}/10`;

  // 選択肢
  let options = [q[1]];
  while(options.length<4){
    const w = words[Math.floor(Math.random()*words.length)][1];
    if(!options.includes(w)) options.push(w);
  }
  options.sort(()=>Math.random()-0.5);

  choicesDiv.innerHTML="";
  options.forEach(opt=>{
    const b = document.createElement("button");
    b.className="choice";
    b.textContent=opt;
    b.onclick = ()=>{
      const correct = opt===q[1];
      b.classList.add(correct?"correct":"wrong");
      quizResults.push({k:q[0],j:q[1],correct});
      quizIndex++;
      setTimeout(()=>{
        if(quizIndex<currentChapter.length) showQuiz();
        else showResult();
      },600);
    };
    choicesDiv.appendChild(b);
  });
}

/* 結果画面 */
const resultScreen = document.getElementById("result");
const resultList = document.getElementById("resultList");
document.getElementById("resBack").onclick = ()=>{
  resultScreen.style.display="none";
  renderChapters();
};
document.getElementById("resRetry").onclick = ()=>{
  resultScreen.style.display="none";
  startChapter(chapters.indexOf(currentChapter));
};
document.getElementById("resNext").onclick = ()=>{
  resultScreen.style.display="none";
  const idx = chapters.indexOf(currentChapter)+1;
  if(idx<chapters.length) startChapter(idx);
  else renderChapters();
};

function showResult(){
  quizScreen.style.display="none";
  resultList.innerHTML="";
  quizResults.forEach(r=>{
    const div = document.createElement("div");
    div.className="result-item "+(r.correct?"correct":"wrong");
    div.innerHTML=`<span>${r.k}</span><span>${r.j}</span><span>${r.correct?"⚪":"×"}</span>`;
    resultList.appendChild(div);
  });
  resultScreen.style.display="flex";
}
</script>
</body>
</html>