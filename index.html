<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>韓国語学習統合版</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #e0f7fa;
}

/* 共通スクリーン */
.screen {
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
  box-sizing: border-box;
  display: none;
  z-index: 100;
}

/* モード選択 */
#modeSelect {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 24px;
  height: 100%;
}
.mode-btn {
  font-size: 26px;
  padding: 24px 40px;
  border-radius: 16px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 4px 6px rgba(0,0,0,.25);
  cursor: pointer;
}
.mode-btn:active { transform: scale(0.95); }

/* ===== フラッシュカード ===== */
#flashCard {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

#wordArea {
  font-size: 40px;
  text-align: center;
  margin: 20px;
  padding: 20px;
  background: #b2ebf2;
  border-radius: 16px;
  width: 80%;
  word-break: break-word;
}

#controls {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

button.fc-btn {
  padding: 14px 22px;
  font-size: 20px;
  border-radius: 12px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
  cursor: pointer;
}
button.fc-btn:active { transform: scale(0.94); }

/* ===== 4択クイズ ===== */
#quiz {
  display: flex;
  flex-direction: column;
  align-items: center;
}

#quizWord {
  font-size: 40px;
  text-align: center;
  margin: 40px 0;
  padding: 20px;
  background: #b2ebf2;
  border-radius: 16px;
  width: 80%;
  word-break: break-word;
}

#choices {
  display: grid;
  grid-template-columns: 1fr;
  gap: 14px;
  width: 80%;
}

.choice {
  font-size: 20px;
  padding: 16px;
  border-radius: 12px;
  border: none;
  background: #ffffff;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
  cursor: pointer;
}
.choice.correct { background: #b9f6ca; }
.choice.wrong { background: #ffcdd2; }

#quizBack {
  margin-top: 20px;
  padding: 12px 24px;
  border-radius: 12px;
  border: none;
  background: #81d4fa;
  color: #033;
  font-size: 18px;
  cursor: pointer;
}

/* 振り返り画面 */
#review {
  display: flex;
  flex-direction: column;
  align-items: center;
}
#reviewList {
  margin: 20px 0;
}
</style>
</head>

<body>

<!-- モード選択 -->
<div id="modeSelect" class="screen" style="display:flex">
  <button class="mode-btn" onclick="startFlash()">フラッシュカード</button>
  <button class="mode-btn" onclick="startQuiz()">4択クイズ</button>
</div>

<!-- フラッシュカード画面 -->
<div id="flashCard" class="screen">
  <div id="wordArea"></div>
  <div id="controls">
    <button class="fc-btn" id="prevBtn">戻る</button>
    <button class="fc-btn" id="toggleBtn">日本語</button>
    <button class="fc-btn" id="nextBtn">次へ</button>
    <button class="fc-btn" id="chapterBackBtn">チャプターに戻る</button>
  </div>
</div>

<!-- クイズ画面 -->
<div id="quiz" class="screen">
  <div id="quizWord"></div>
  <div id="choices"></div>
  <button id="quizBack" onclick="backToMenu()">もどる</button>
</div>

<!-- 振り返り画面 -->
<div id="review" class="screen">
  <div id="reviewList"></div>
  <button onclick="nextChapterQuiz()">もう一度同じチャプター</button>
  <button onclick="backToChapterQuiz()">チャプター選択に戻る</button>
</div>

<script>
let words = [];
let chapters = [];
let currentChapter = [];
let index = 0;
let showJP = false;

// クイズ用
let currentQuiz = null;
let quizIndex = 0;
let quizChapter = [];
let quizResults = [];

/* ===== CSV読み込み ===== */
fetch("words.csv")
  .then(r => r.text())
  .then(text => {
    words = text.trim().split("\n").map(l => l.split(",")).filter(w => w.length >= 2);
    for(let i=0;i<words.length;i+=10){
      chapters.push(words.slice(i,i+10));
    }
  });

/* ===== 共通 ===== */
function hideAll() {
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
}

function backToMenu(){
  hideAll();
  document.getElementById("modeSelect").style.display="flex";
}

/* ===== フラッシュカード ===== */
const wordDiv = document.getElementById("wordArea");
const flashCardScreen = document.getElementById("flashCard");

function startFlash(){
  hideAll();
  flashCardScreen.style.display="flex";
  currentChapter = chapters[0];
  index = 0;
  showJP = false;
  renderWord();
}

function renderWord(){
  wordDiv.textContent = showJP ? currentChapter[index][1] : currentChapter[index][0];
}

document.getElementById("prevBtn").onclick = ()=>{
  index = (index-1 + currentChapter.length)%currentChapter.length;
  showJP=false;
  renderWord();
};
document.getElementById("nextBtn").onclick = ()=>{
  index = (index+1)%currentChapter.length;
  showJP=false;
  renderWord();
};
document.getElementById("toggleBtn").onclick = ()=>{
  showJP=!showJP;
  renderWord();
};
document.getElementById("chapterBackBtn").onclick = backToMenu;

/* ===== 4択クイズ ===== */
function startQuiz(){
  hideAll();
  document.getElementById("quiz").style.display="flex";
  startQuizChapter(0);
}

function startQuizChapter(chIndex){
  quizChapter = chapters[chIndex];
  quizIndex = 0;
  quizResults = [];
  nextQuiz();
}

function nextQuiz(){
  if(quizIndex>=quizChapter.length){
    showReview();
    return;
  }
  const q = quizChapter[quizIndex];
  currentQuiz = q;
  document.getElementById("quizWord").textContent = q[0];

  let choices = [q[1]];
  while(choices.length<4){
    const w = words[Math.floor(Math.random()*words.length)][1];
    if(!choices.includes(w)) choices.push(w);
  }
  choices.sort(()=>Math.random()-0.5);

  const box = document.getElementById("choices");
  box.innerHTML="";
  choices.forEach(c=>{
    const b = document.createElement("button");
    b.className="choice";
    b.textContent=c;
    b.onclick=()=>checkAnswer(b,c===q[1]);
    box.appendChild(b);
  });
}

function checkAnswer(btn, correct){
  document.querySelectorAll(".choice").forEach(b=>b.disabled=true);
  btn.classList.add(correct?"correct":"wrong");
  if(!correct){
    document.querySelectorAll(".choice").forEach(b=>{
      if(b.textContent===currentQuiz[1]) b.classList.add("correct");
    });
  }
  quizResults.push(correct);
  quizIndex++;
  setTimeout(nextQuiz,800);
}

/* ===== 振り返り ===== */
function showReview(){
  hideAll();
  const reviewScreen = document.getElementById("review");
  reviewScreen.style.display="flex";
  const listDiv = document.getElementById("reviewList");
  listDiv.innerHTML="";
  quizResults.forEach((r,i)=>{
    const div = document.createElement("div");
    div.textContent=`${i+1}: ${r?"○":"×"}`;
    listDiv.appendChild(div);
  });
}

function nextChapterQuiz(){
  quizIndex=0;
  quizResults=[];
  nextQuiz();
}

function backToChapterQuiz(){
  hideAll();
  document.getElementById("quiz").style.display="flex";
}
</script>

</body>
</html>