<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>韓国語4択クイズ</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #e0f7fa;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

/* ===== チャプター選択 ===== */
#chapterSelect {
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
  box-sizing: border-box;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

#chapters {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.chapter-btn {
  aspect-ratio: 1 / 1;
  font-size: 22px;
  border-radius: 12px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,0.2);
}

.chapter-btn:active { transform: scale(0.94); }

/* ===== クイズ画面 ===== */
#quiz {
  display: none;
  position: fixed;
  inset: 0;
  padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
  box-sizing: border-box;
  overflow: hidden;
}

/* 中央にまとめるラッパー */
#quizContent {
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center; /* 縦中央 */
  align-items: center;     /* 横中央 */
  gap: 20px;
}

#quizHeader {
  position: absolute;
  top: 16px;
  left: 16px;
  text-align: left;
  font-size: 18px;
  line-height: 1.2;
}

#quizWord {
  font-size: 40px;
  text-align: center;
  background: #b2ebf2;
  padding: 20px;
  border-radius: 16px;
  max-width: 90%;
}

#choices {
  display: grid;
  grid-template-columns: 1fr;
  gap: 14px;
  width: 100%;
  max-width: 400px; /* 選択肢幅制限 */
}

.choice {
  font-size: 20px;
  padding: 16px;
  border-radius: 12px;
  border: none;
  background: #ffffff;
  box-shadow: 0 3px 5px rgba(0,0,0,.2);
  word-break: break-word;
}
.choice.correct { background: #b9f6ca; }
.choice.wrong { background: #ffcdd2; }

#quizBack {
  position: absolute;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 20px;
  padding: 12px 24px;
  border-radius: 10px;
  border: none;
  background: #81d4fa;
  color: #033;
  box-shadow: 0 3px 5px rgba(0,0,0,0.2);
}
#quizBack:active { transform: translateX(-50%) scale(0.94); }
</style>
</head>

<body>

<!-- チャプター選択 -->
<div id="chapterSelect">
  <div id="chapters"></div>
</div>

<!-- クイズ画面 -->
<div id="quiz">
  <div id="quizContent">
    <div id="quizHeader">チャプター 1<br>1/10</div>
    <div id="quizWord"></div>
    <div id="choices"></div>
  </div>
  <button id="quizBack" onclick="backToChapterSelect()">チャプター選択に戻る</button>
</div>

<script>
let words = [];
let chapters = [];
let currentChapter = [];
let currentQuestionIndex = 0;
let correctAnswers = [];
let quizChapterIndex = 0;

const chaptersDiv = document.getElementById("chapters");
const chapterSelect = document.getElementById("chapterSelect");
const quiz = document.getElementById("quiz");
const quizWord = document.getElementById("quizWord");
const choicesDiv = document.getElementById("choices");
const quizHeader = document.getElementById("quizHeader");

// CSV読み込み
fetch("words.csv")
  .then(r => r.text())
  .then(text => {
    words = text.split("\n").map(l => l.split(",")).filter(w => w[0]);
    for (let i = 0; i < words.length; i += 10) {
      chapters.push(words.slice(i, i+10));
    }
    renderChapterButtons();
  });

function renderChapterButtons() {
  chapters.forEach((_, i) => {
    const b = document.createElement("button");
    b.textContent = i + 1;
    b.className = "chapter-btn";
    b.onclick = () => startQuiz(i);
    chaptersDiv.appendChild(b);
  });
}

function startQuiz(chapterIndex) {
  quizChapterIndex = chapterIndex;
  currentChapter = chapters[chapterIndex];
  currentQuestionIndex = 0;
  correctAnswers = [];
  chapterSelect.style.display = "none";
  quiz.style.display = "block";
  renderQuestion();
}

function renderQuestion() {
  const q = currentChapter[currentQuestionIndex];
  quizWord.textContent = q[0];

  quizHeader.innerHTML = `チャプター ${quizChapterIndex+1}<br>${currentQuestionIndex+1}/10`;

  let options = [q[1]];
  while (options.length < 4) {
    const rand = currentChapter[Math.floor(Math.random()*currentChapter.length)][1];
    if (!options.includes(rand)) options.push(rand);
  }
  options.sort(() => Math.random() - 0.5);

  choicesDiv.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = opt;
    btn.onclick = () => selectAnswer(btn, opt === q[1]);
    choicesDiv.appendChild(btn);
  });
}

function selectAnswer(btn, isCorrect) {
  correctAnswers.push(isCorrect);
  btn.classList.add(isCorrect ? "correct" : "wrong");
  // 正解のボタンを表示
  if (!isCorrect) {
    Array.from(choicesDiv.children).forEach(b => {
      if (b.textContent === currentChapter[currentQuestionIndex][1])
        b.classList.add("correct");
    });
  }

  // 次の問題
  setTimeout(() => {
    currentQuestionIndex++;
    if (currentQuestionIndex < currentChapter.length) {
      renderQuestion();
    } else {
      showResult();
    }
  }, 800);
}

function showResult() {
  // 結果表示を簡易アラート（必要に応じて結果画面作り込めます）
  let resultStr = "";
  currentChapter.forEach((q,i) => {
    resultStr += `${q[0]} → ${q[1]} : ${correctAnswers[i] ? "〇" : "×"}\n`;
  });
  alert(resultStr);
  backToChapterSelect();
}

function backToChapterSelect() {
  quiz.style.display = "none";
  chapterSelect.style.display = "block";
}
</script>

</body>
</html>